#!/bin/bash

APIKEY_1='91345F61-E82D-4972-B25F-4A876C64D362'  # ë°œê¸‰ë°›ì€ API í‚¤
DATASETKEY_1=71300                             # ë°ì´í„°ì…‹ í‚¤
WORKDIR=$(pwd)                                 # í˜„ì¬ ë””ë ‰í† ë¦¬

# ë‹¤ìš´ë¡œë“œí•  filekey ëª©ë¡
filekeys_1=(
    #525981 525982 #525983 525984 525985
    #525986 525987 525988 
    #525989 525990
    #525993 525994 525997 525998 526001 526002
    #526005 526006 526009 526010 526013 526014
    #526017 526018 526021 526022 526025 526026
    #463808 463809 463810 463811
    #463820 463821 463822 463823
    #463832 463833 463834 463835
    #463844 463845 463846 463847
    463812 463813 463814 463815 463816 463817 463818 463819
    463824 463825 463826 463827 463828 463829 463830 463831
    463836 463837 463838 463839 463840 463841 463842 463843
    463848 463849 463850 463851 463852 463853 463854 463855
)

for key in "${filekeys_1[@]}"; do
    echo "ğŸ”½ [$key] ë‹¤ìš´ë¡œë“œ ì‹œì‘"
    
    # íŒŒì¼ ë‹¤ìš´ë¡œë“œ
    aihubshell -mode d -datasetkey 71300 -filekey $key -aihubapikey "$APIKEY_1"
    
    # zip íŒŒì¼ íƒìƒ‰ (10ë¶„ ì´ë‚´ì— ìƒì„±ëœ ê²ƒ ì¤‘ ê°€ì¥ ìµœì‹ )
    zip_path=$(find "$WORKDIR" -maxdepth 5 -type f -name "*$key*.zip" -printf "%T@ %p\n" | sort -n | tail -n 1 | cut -d' ' -f2-)

    
    if [[ -z "$zip_path" ]]; then
        echo "âš ï¸ [$key] zip íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìŠ¤í‚µ."
        continue
    fi

    # ì••ì¶• í•´ì œí•  ë””ë ‰í† ë¦¬ ì„¤ì •
    unzip_dir="${zip_path%.zip}_unzipped"
    mkdir -p "$unzip_dir"

    echo "ğŸ“‚ [$key] ì••ì¶• í•´ì œ ì¤‘... â†’ $unzip_dir"
    unzip -q "$zip_path" -d "$unzip_dir"

    # ì••ì¶• íŒŒì¼ ì‚­ì œ
    rm -f "$zip_path"
    echo "ğŸ—‘ï¸ [$key] zip íŒŒì¼ ì‚­ì œ ì™„ë£Œ"

    echo "âœ… [$key] ì™„ë£Œ"
done